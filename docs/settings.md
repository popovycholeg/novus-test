# Налаштування

![settingsMenu](/img/settings/settingsMenu.png)

Меню налаштувань розбито на наступні підпункти:

* [`Компанії`](/settings/#_2) - налаштування компаній на даному сервері, має доступ тільки [Супер Адмін](/#_3)
* [`Станції`](/settings/#_2) - налаштування станцій поточної компанії.
* `Групи` - налаштування груп моніторингу
* `Похідні параметри` - налаштування похідних параметрів(не справжні параметри, створені в результаті певних обчислень)
* `Таблиці` - налаштування таблиць з розділу [аналітика](/analytics/#_3)
* `Схеми` - налаштування схем з розділу [аналітика](/analytics/#_5)

## Компанії

![companies](img/settings/companies.png)

Відображає таблицю з даними про компанії, дає можливіть створювати нові та редагувати існуючі компанії.

1. При натисканні на кнопку `Створити компанію` вікриється наступне вікно

![companyAdd](img/settings/companyAdd.png)

**Поля:**

* `Назва компанії` - повна назва компанії відображається у описі;
* `Коротка назва` - коротка назва, відображається поруз з логотипом компанії;
* `Тема` - кольорова тема компанії. Сайт має кілька тем. Вони міняю забарвлення і деякі зображення. Застосована тема діє на всіх користувачів компанії;
* `Логотип` - логотип компанії, що відображається з назвою, можна вибрати серед існуючих чи завантажити свій;
* `Назва для телеграм бота` - назва боту в Telegram;
* `Назва для вайбер бота` - назва боту в Viber;
* `QR-картинка для вайбера (посилання)` - посилання на Viber бота;
* `Інформаційна сторінка` - інформація, що відображається при кліку на пікторнаму компанії в меню;
* `Опис` - Опис компанії інформація для Супер Адміна;
* `Публічна сторінка` - коли вибрано, створиться посилання на публічну сторінку з показниками в групах;
* `Заборонити управління без додаткового підтвердження (CCID / Відбиток пальця)` - коли вибрана дана опція, будь-яка дія з розділу керування потребуватиме верифікації відбитку пальця чи використання спеціального цифрового носія;
* `Сигналізація на сайті` - при виході параметрів за межі, на сайті ввімкнеться звукове сповіщення про подію

2. При натисненні кнопки [edit](/img/common/edit.png) у таблиці, відкриється вікно редагування вибраної компанії, вікно редагування має всі ті ж поля, що описано вище.


## Станції

![Станції](/img/settings/stations.png)

Відображає таблицю з даними про станції поточної компанії, дає можливіть створювати нові та редагувати існуючі станції.

### Створити станцію

При натисканні на `Cтворити станцію`, з'являється наступне вікно

![Станції](/img/settings/addStationModal.png)

* `Назва станції` - відображувана назва станції, обов'язкове поле;
* `Адреса` - адреса станції(рекомендовано брати адресу з google maps)
* `Опис` - опис станції, з'являється при натисканні на ![info](/img/common/info.png) в списку станцій
* `Широта` та `Довгота` - фізична широта станції, для визначення широти та довготи місця рекомедовано скористатися сервісом [openstreetmap](https://www.openstreetmap.org/). Просто введіть в пошуку вашу адресу, чи знайдіть місце на карті і натисніть `Показати адресу`, і широта та довгота відобразяться у інформаційному вікніт зліва

![openstreet](/img/settings/openstreet.png)

### Інформація про зайняті порти

При натисканні на `Інформація про зайняті порти`, з'являється наступне вікно

![openstreet](/img/settings/portsModal.png)

Опитування пристроїв відбувається по виділеним для них портах. Один порт одночасно може опитувати багато однотипних пристроїв. Приорітетом є ручне задання порту. Пристрої, що підключаються до сервера напряму(пристрій -> модем -> сервер), а також не мають унікального ідентифікатора потрібно підключати на окремий порт, при цьому ідентифікатором пристрою буде номер порту. 

**Зауважте:** нові пристрої нових типів потрібно підключати на не зайняті порти.

### Станції - Дії

* При натисканні на ![openstreet](/img/settings/mapMarker.png) відкриється вікно редагування, відображення параметрів на [карті](/map).
При виборі станції на карті тільки вибрані тут параметри будуть відображатися.

![mapParametersModal](/img/settings/mapParametersModal.png)

* При натисканні ![edit](/img/common/edit.png) відкиється вікно редагування станції з усіма полями, описаними у [створенні станції](/settings/#_4)

* При натисканні ![delete](/img/common/delete.png) з'явиться вікно підтвердження видалення станції. Разом зі станцією також видаляються звязані пристрої, параметри та архівні дані.

![stDeleteConfirm](/img/settings/stDeleteConfirm.png)

* `Налаштування пристроїв` - відкриє сторінку [налаштування пристроїв](/settings/#_7) вибраної станції

## Налаштування пристроїв

![equipmentSettings](/img/settings/equipmentSettings.png)

Відображає таблицю з даними про пристрої вибраної станції, дає можливіть створювати нові, редагувати та видаляти існуючі.

### Додати пристрій

При натисканні кнопки `Додати пристрій` відкриється наступне модальне вікно.

![addEquipment](/img/settings/addEquipment.png)

* `Тип пристрою` - тип пристрою, що підключається, в залежності від типу пристрою, він матиме різний список параметрів.
* `Назва` - назва пристрою, що відображатиметься на сторінці параметрів та інших.
* `Ідентифікатор` - залежно від підключення може мати різні значення.
Якщо пристрій має свій власний унікальний ідентифікатор, який можна з нього зчитати, то це буде його ідентифікатором.
Наприклад, для VLT® AQUA Drive FC 202 ідентифікатор виглядає наступним чином 123456G789 .
Якщо пристрій не має унікального ідентифікатора і підключений за допомогою PaspberryPI, то його ідентифікатор надає сама PaspberryPI і потрібно дивитися її конфігурацію.
* `Справжній пристрій` - пристрої можуть бути віртуальними, наприклад Derivative - 
пристрій контейнер для [похідних параметрів](/settings/#_10), якщо опція не вибрана, 
стан параметру (Чи він в мережі), не впливатиме на стан станцій та груп.

[ **Інформація про зайняті порти** - дивіться детальніше у розділі станції](/settings/#_5)

### Пристрої - Дії 

* При натисканні ![edit](/img/common/edit.png) відкиється вікно редагування пристрою з усіма полями, описаними у [додаванні пристрою](/settings/#_7) за виключення типу пристрою, тип пристрою після створення не можна змінити.

* При натисканні ![delete](/img/common/delete.png) з'явиться вікно підтвердження видалення пристрою. Разом з пристроєм також видаляються звязані параметри та архівні дані.

* `Додати параметри` - відкриється модальне вікно редагування, параметрів вибраного пристрою.

![addParametersModal](/img/settings/addParametersModal.png)

1. Для додавання параметрів до пристрою, виберіть параметри, які ви хочете додати зі списку і натисніть кнопку зберегти.
2. Відображаються уже додані параметри, для редагування чи видалення параметру натисніть ![edit](/img/common/edit.png) і ви перейдете на сторінку [налаштування параметру](/parameters/#_4)

## Групи

![groups](/img/settings/groups.png)

Відображає таблицю з даними про групи, дає можливіть створювати нові, редагувати та видаляти існуючі.

### Cтворити групу

![groups](/img/settings/groupsAddModal.png)

* `Назва групи` - Назва групи, що відображетиметься на різних розділах сайту.
* `Залежна станція` - Якщо группа створюється з ціллю відображати параметри тільки однієї станії, то оберіть її в цьому полі. Потім буде можливо побачити цю групу на карті за координатам обраної станції, та адресою.
* `Відображати ім'я станції над іменем параметрів` - на сторінці [параметрів](/parameters), у розділі групи, над параметрами відображатиметься назва зв'язаної станції.

### Дії

* ![edit](/img/common/edit.png) - редагувати групу всі поля описані у [створенні](/settings/#c)
* ![delete](/img/common/delete.png) - видалити групу, зв'язані параетри НЕ будуть видалені.
* `Обрати параметри` - вибір інформаційних параметрів для групи

![addParametersToGroups](/img/settings/addParametersToGroups.png)

Виберіть параметри, які ви хочете щоб відображалися в данцій групі і натисніть `Зберегти`.

* `Обрати параметри керування` - вибір параметрів керування, аналогічно з `Обрати параметри`.

## Похідні параметри

![derivative](/img/settings/derivative.png)

На цій сторінці можна створювати, редагувати та видаляти похідні параметри  
**Похідний параметр** - параметр, який відображає значення після виконання певних перетворень. Існує декілька видів похідних параметрів.

**Як створити похідний параметр:**  
**1.** Спочатку потрібно підготувати для нього місце. Мати абстрактний пристрій та його параметри.  
    1.1 Створення абстрактного пристрю - Налаштування -> Станції -> (для обраної станції) Налаштування пристроїв -> Додати пристрій. Тип пристрою *Derivative*, Ідентифікатор придумайте, він повинен бути унікальним.  
    1.2 Створення параметра - Для доданого пристрою - Додати параметри. Оберіть потрібну кількість. Змініть назву створених параметрів через Меню - Показники - (меню параметра) - Налаштування

**2.** Після того як ви підготуєте місце для похідного параметру натисніть `Створити похідний параметр` і перед вами відкриється вікно додавання похідного параметру.  
![derivativeModal](/img/settings/derivativeModal.png)  

  2.1. `Параметр для запису` - виберіть зі списку параметр, який ви створили у кроці 1.  
  2.2  `Опис` - додайте опис, для чого створений даний параметр, щоб полегшити розуміння при його редагуванні. Необов'язкове поле.  
  2.3 `Формула` - виберіть тип формули:

* `Математична` - дозволяє використовуючи інші параметри створювати параметри на іх основі використовуючи математичні формули, повний список описаний тут https://www.npmjs.com/package/expr-eval.  
Параметри в формулі виглядають як #234 - знак решітки та номер.  
Приклад формул:

        #235 + #234 + 500  
        #235 / (#234-10)  

* `Усереднення` - усереднення значень обраного параметра.  
Правила заповнення: потрібно вказати параметр(з #) та період в хвилинах (з *) (останні n хвилин).  
Наприклад:  

        #235 *13 - означає усереднювати значення параметра 235 за останні 13 хвилин

* `Математичні архіви` - Використувуючи той же синтаксис що і в математичній формулі.
Але додатково можна вказати не тільки поточне значення а і значення з архівів.  
`$[#IDпараметра;Хвилини]`  
Наприклад:  
-- `$[#235;60]` означає взяти значення параметра 235 60 хвилинної давності.  
-- потрібно дізначися різницю параметра за годину `#235 - $[#235;60]`  
-- параметр *удельный куб* `(#1 - $[#1;60])/(#2 - $[#2;60])`  

* `Напрацювання` - Правила заповнення: потрібно вказати параметр(з #).
По стану цього параметра буде рахуватися час роботи (в хвилинах) на основі цього параметра.
В час коли параметр був >0 рахується як робоче.  
Наприклад: `#17` - показуватиме сумарний час роботи від початку створення параметру

* `Різниця` показує на скільки змінився параметр з вказаної години, щодня у вказаній годині параметр обнуляється
Правила заповнення: потрібно вказати параметр(з #). та вказати початковий час у форматі(hh:mm) `${#IDпараметра;Час}`  
Наприклад: `${#2;12:00}`, рахуватиме різницю поточного значення із значенням в 12:00

* `Зворотній клапан` показує чи змінилося значення параметру з певного часу після виконання певної умови
(Якщо немає амперажу чи напруги(можливий залишковий заряд можна вказати), а значення лічильника змінюється(з певною похибкою), отже не спрацював зворотній клапан АВАРІЯ!)
Правила заповнення: `${#a;b;c}[#d;e;f]`
Підставляйте значення у формулу, як вказано вище, не використовуйте пробіли  
**a** - ID параметру, що відстежується;  
**b** - Логічний оператор(<,>, >=, <=, !=, ==);  
**c** - Граничне значення(В тих же одиницях вимірювання, що і "a");  
**d** - ID параметру, що перевіряється, якщо секція `{#a; b; c}` виконалась;  
**e** - Різниця часу(у хвилинах), береться значення "d" з архіву, вказаної давності;  
**f** - Похибка вимірювання(Максимальна допустима зміна "d", яка не змінить значення на 1(АВАРІЯ));  
Наприклад: `${#2;>=;1.2}[#10;7;5]`, Якщо значення параметра #2 більше рівне 1.2, то переходимо до секції [], якщо ні то повертає 0, якщо #10 змінило своє значення у порівнянні із значенням 7 хв тому більше ніж на 5 вертає 1, якщо ні вертає 0

2.4 `Рядок формули` - введіть формулу, за правилами відповідно до обраного типу формули.  
2.5 `Параметри та їх ID` - перелік параметрів та їх ID, для вводу у рядку формули.

**3.** Після заповнення усіх полів натисніть кнопку `Зберегти`

## Таблиці

![tableSettings](/img/settings/tableSettings.png)    
Сторінка додавання, редагування та видалення таблиць.

### `Створити таблицю` 
Перед вами відкриється наступне вікно

![tableAddModal](/img/settings/tableAddModal.png)   

* `Назва табиці` - назва, що відображається у списку таблиць;
* `Дані` - якщо у вас уже є готова створена таблиця, просто вставте сюди текст з даними, якщо ні залише поле порожнім і перейдіть до редагування;

### Конструктор таблиць
Натиснувши на ![constructor](/img/settings/constructor.png) відкриється конструктор таблиці

![dynamicTablesConstructor](/img/settings/dynamicTablesConstructor.png)

* Введіть потрібну вам кількість стовпців та рядків, та натисніть `Ok`, конструктор побудує вашу таблицю.
![alt](/img/settings/rowsColumns.png)

* `Зберегти` - зберігає зроблені зміни.

* У полі нижче введіть, бажані css стилі.
![alt](/img/settings/cssTables.png)

* `Що показати в клітинці` - тип відображення клітинки, тільки на цій сторінці
, якщо зберегти таблицю з іншим значенням, в аналітиці відображатиметься `Кінцевий текст`
![alt](/img/settings/cellAppearance.png)

Виберіть одну чи більше клітинок(для вибору декількох клітинок утримуйте `Shift`) і натисніть ![edit](/img/common/edit.png) 
для редагування клітинки.  

![editCell](/img/settings/editCell.png)

* `Cтанція` - виберіть станцію, для для якої клітинка редагується.
* Виберіть ті чекбокси, налаштування яких для вас потрібні.
* Виберіть тип значення для відображення.
* Створіть свою формулу, [за правилами математичної формули, як в похідних параметрах](/settings/#_10)
* Якщо потрібно виберіть параметр, що показуватиме стан клітинки.
* Додайте ваші css стилі.

Виберіть одну чи більше клітинок(для вибору декількох клітинок утримуйте `Shift`) і натисніть ![edit](/img/settings/intelEditBtn.png) 
для інтелектуального редагуввання клітинок.  

![editCell](/img/settings/intelEdit.png)


## Схеми

